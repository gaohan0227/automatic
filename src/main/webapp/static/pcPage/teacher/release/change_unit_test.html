<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../css/index.css">
    <script type="text/javascript" src="../../libs/jquery.min.js"></script>
    <script type="text/javascript" src="../../libs/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../js/page.js"></script>
    <script type="text/javascript" src="../../js/tool.js"></script>
    <script type="text/javascript" src="../../js/pageInit.js"></script>
    <script type="text/javascript" src="../../js/vue.min.js"></script>
   <script type="text/javascript" src="../../js/service/service-tool.js"></script>
   <script type="text/javascript" src="../../js/service/service-verify.js"></script>    
    <style>
        .unit_test_list {
            padding: 0 0.8rem;
        }

        .unit_test_list .unit_test_item {
            width: 100%;
            height: 3rem;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eaeaea;
        }

        .unit_test_list .unit_test_item img {
            width: 0.6rem;
            height: 0.6rem;
            margin: 1rem 0;
            margin-right: 0.7rem;
        }

        .unit_test_list .unit_test_item .checkImg {
            width: 1rem;
            height: 1rem;
        }

        .unit_test_list .unit_test_item .unit_test_title {
            padding-right: 0.7rem;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2F2F2F;
            font-size: 0.8rem;
        }

        .unit_test_fixed {
            padding: 0.35rem 0.8rem;
            position: fixed;
            bottom: 0rem;
            left: 0;
            width: 100%;
            height: 2.7rem;
            background: #fff;
            box-shadow: 0 0.1rem 0.5rem 0 rgba(0, 0, 0, 0.1);
        }

        .unit_test_fixed .unit_test_btn {
            width: 100%;
            height: 2rem;
            background: #5296FF;
            border-radius: 1rem;
            color: #fff;
            text-align: center;
            font-size: 0.75rem;
            line-height: 2rem;
        }

        .unit_test_fixed .unit_test_btn.gray_bg {
            background: #EAEAEA;
            color: #acacac;
        }
    </style>
</head>

<body>
    <div class="vueApp" v-cloak>
        <div v-if="isLoad">
            <div class="listData.length>'0'">
                <div class="unit_test_list">
                    <div class="unit_test_item" tapmode @click="fnOpenUnitTest(item.id)" v-for="item in listData">
                        <img class="checkImg" :src="postData.aSetUnitQuestionId==item.id?'../../image/release/checked.png':'../../image/release/no_check.png'" alt="" tapmode @click="fnCheckUnitTest(this,item.id)">
                        <p class="unit_test_title">{{item.unitTitle}}</p>
                        <img src="../../image/release/go_page_unit.png" alt="">
                    </div>
                </div>
            </div>
            <div class="none_data" v-if="listData.length=='0'">
                <div>
                    <img src="../../image/no_page/no_test.png" alt="">
                </div>
            </div>
        </div>
        <div style="height:2.7rem;width:100%;" class="change_bottom"></div>
        <!-- <div class="unit_test_fixed">
            <div class="unit_test_btn">发布</div>
        </div> -->
    </div>
</body> 
<script type="text/javascript">
    var vm;
    window.onload =function() {
        fnInit();
        fnInitPage();
//      api.addEventListener({
//          name: 'submitBottom'
//      }, function(ret, err) {
//          if (ret) {
//              fnReleaseUnitTest();
//          }
//      });
    }

    function fnInit() {
        vm = new Vue({
            el: ".vueApp",
            data: {
                listData: [],
                pageNo: "1",
                isLoad: false,
                postData: {
                    classId:   "",
                    unitId: "",
                    testTime:   "",
                    testBeginDate:  "",
                    aSetUnitQuestionId: "",
                }
            }
        })
    }


    function fnCheckUnitTest(el, uId) {
        if (el && el.stopPropagation) {
            el.stopPropagation();
        } else {
            window.event.cancelBubble = true;
        };
        if (vm.postData.aSetUnitQuestionId == uId) {
            vm.postData.aSetUnitQuestionId = "";
        } else {
            vm.postData.aSetUnitQuestionId = uId;
        }
    }

    function fnOpenUnitTest(id) {
        var pageData = {
            "unitId": vm.postData.unitId,
            "id": id
        }
        fnOpenPublicWin("", "release/unit_test", pageData)
    }

    function fnInitPage() {
        fnGetList();
//      fnAddHeaderRefreshingEvent(function() { //设置下拉刷新
//          fnGetList('headerRefreshing');
//      });
//      fnAddFooterLoadingEvent(function() { // 设置上拉加载
//          fnGetList('load');
//      });
    }

    function fnGetList(pSign) {
        if (pSign != "load") { //刷新
            if (pSign != "headerRefreshing") {
            }
            vm.pageNo = 1;
        } else { //加载
        }
        var postData = {
            "dynamicMaterialId": "111",
            "pageNo": vm.pageNo,
            "pageSize": "10"
        }
        POST("apiAppTeacher/findUnitTest", postData, function(ret, err) {
            if (ret && ret.status == "200") {
                if (vm.pageNo == '1') {
                    vm.listData = [];
                }
                vm.listData.push.apply(vm.listData, ret.data.listData);
                console.log(JSON.stringify(vm.listData))
                if (!vm.isLoad) {
                    fnOpenBottomFrame();
                }
                vm.pageNo++;
            }
//          $S.CloseProgress();
//          api.refreshHeaderLoadDone();
            vm.isLoad = true;
//          api.setFrameAttr({
//              name: 'mine/change_bottom',
//              hidden: vm.listData.length > 0 ? false : true
//          });

        })
    }
    //修改当前的frame的大小以及打开底部的frame
    function fnOpenBottomFrame() {
//      var bottom_h = $api.offset($api.dom(".change_bottom")).h;
//      var _headerH = api.pageParam.headerH;
//      var _footerH = api.pageParam.footerH;
//      api.setFrameAttr({
//          name: api.frameName,
//          rect: {
//              x: 0,
//              y: _headerH,
//              w: "auto",
//              h: api.winHeight - _headerH - _footerH - bottom_h
//          }
//      });
//      var param = {
//          name: "mine/change_bottom",
//          url: './change_bottom.html',
//          useWKWebView: true,
//          bgColor: 'rgba(0,0,0,0)',
//          rect: {
//              x: 0,
//              y: api.winHeight - _footerH - bottom_h,
//              w: "auto",
//              h: bottom_h
//          },
//          pageParam: {
//              listData: vm.listData,
//              bottomText: "发布"
//          }
//      }
//      fnOpenFrame(param);
//      $api.css($api.dom(".change_bottom"), "height:0;");
    };
    //发布单元测试
    var isClick = true;

    function fnReleaseUnitTest() {
        if (vm.postData.aSetUnitQuestionId == "") {
            fnToast("请选择单元测试");
            return;
        }
        if (isClick) {
            isClick = false;
             ShowProgress();
            POST("apiAppTeacher/publishUnitTest", vm.postData, function(ret, err) {
                if (ret && ret.status == "200") {
                    fnToast("发布成功");
                    setTimeout(function() {
//                      api.closeToWin({
//                          name: 'main'
//                      });
                    }, 800)
                } else {
                    isClick = true;
                }
            })
        }
    }
</script>

</html>
