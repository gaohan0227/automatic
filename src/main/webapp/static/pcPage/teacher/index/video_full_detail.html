<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/index.css">
    <script type="text/javascript" src="../libs/jquery.min.js"></script>
    <script type="text/javascript" src="../libs/bootstrap.min.js"></script>
    <script type="text/javascript" src="../js/page.js"></script>
    <script type="text/javascript" src="../js/tool.js"></script>
    <script type="text/javascript" src="../js/pageInit.js"></script>
    <script type="text/javascript" src="../js/vue.min.js"></script>
   <script type="text/javascript" src="../js/service/service-tool.js"></script>
   <script type="text/javascript" src="../js/service/service-verify.js"></script>

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            background: #fff;
            font-size: 20px !important;
        }

        .dub_detail_top {
            position: sticky;
            position: -webkit-sticky;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 999;
        }

        .dub_video {
            width: 100%;
            height: 56vw;
            background: url(../image/no_page/dub_detail.png) no-repeat;
            background-size: cover;
            position: relative;
        }

        .dub_video header {
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0) 100%);
        }

        .dub_detail_header {
            display: flex;
            padding: 0 0.2rem;
            justify-content: space-between;
            align-items: center;
        }

        .dub_detail_header img {
            width: 1rem;
            height: 1rem;
            margin: 0.6rem;
        }

        .dub_detail_header img:last-child {
            width: 1.1rem;
            height: 1.1rem;
            margin: 0.55rem;
            margin-right: 0.6rem;
        }

        .dub_video .dub_play {
            background: linear-gradient(360deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 100%);
            height: 2rem;
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 0.3rem;
        }

        .dub_video .dub_play img {
            margin: 0.5rem;
            width: 1rem;
            height: 1rem;
        }

        .dub_video .dub_play .dub_progress {
            display: flex;
            flex: 1;
            height: 2rem;
            align-items: center;
            justify-content: center;
        }

        .dub_video .dub_play .dub_progress .dub_time {
            font-size: 0.55rem;
            color: #fff;
            padding-right: 0.5rem;
        }

        .dub_video .dub_play .dub_progress .dub_progress_bar {
            flex: 1;
            position: relative;
        }

        .dub_video .dub_detail_video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rang_width_div {
            position: absolute;
            top: 50%;
            left: 0rem;
            right: 0rem;
            height: 0.15rem;
            transform: translateY(-50%);
        }

        .rang_width_div .rang_width {
            background: #fff;
            width: 0;
            border-radius: .1rem;
            height: 0.15rem;
            position: relative;
            z-index: 9;
            width: 0%;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            border-radius: 0.1rem;
            background: rgba(255, 255, 255, 0.4);
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        input[type=range]::-webkit-slider-runnable-track {
            height: 0.15rem;
            border-radius: 0.1rem;
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            -webkit-appearance: none;
            height: 0.4rem;
            width: 0.4rem;
            transform: translateY(-32%);
            border-radius: 100%;
            background: #fff;
            position: relative;
            border: none;
            z-index: 9999;
        }

        .dub_title {
            padding: 0.9rem 0.8rem;
            line-height: 1.2rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: #2f2f2f;
            background: #fff;
        }

        .dub_detail_fixed {
            padding: 1rem 0.8rem;
            padding-top: 0.7rem;
            position: fixed;
            bottom: 0rem;
            left: 0;
            width: 100%;
            height: 4rem;
            background: #fff;
        }

        .dub_detail_fixed .dub_detail_btn {
            width: 100%;
            height: 2.3rem;
            background: #F7D76D;
            box-shadow: 0 0.2rem 0.7rem -0.2rem #F7D76D;
            border-radius: 1.2rem;
            color: #2f2f2f;
            text-align: center;
            font-size: 0.8rem;
            line-height: 2.3rem;
        }

        .dub_rank {
            padding-top: 1rem;
        }

        .dub_rank .dub_rank_title {
            height: 1.1rem;
            line-height: 1.1rem;
            font-size: 0.8rem;
            padding: 0 0.8rem;
            position: relative;
            display: flex;
            color: #2f2f2f;
            align-items: center;
        }

        .dub_rank .dub_rank_title:before {
            content: "";
            position: absolute;
            top: 0.2rem;
            bottom: 0.2rem;
            background: #F7D76D;
            border-radius: 0.1rem;
            width: 0.2rem;
        }

        .dub_rank .dub_rank_title span {
            padding-left: 0.5rem;
            padding-right: 0.3rem;
        }

        .dub_rank .dub_rank_title div {
            flex: 1;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            font-weight: normal;
            font-size: 0.75rem;
        }

        .dub_rank .dub_rank_title div span {
            font-size: 0.6rem;
            padding: 0 0.15rem;
        }

        .dub_rank .dub_rank_title div img {
            width: 0.6rem;
            height: 0.6rem;
        }

        .dub_rank_list {
            padding: 1rem 0.8rem;
            padding-left: 0.55rem;
        }

        .dub_rank_list .dub_rank_item {
            height: 2.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dub_rank_list .dub_rank_item .rank_logo {
            width: 1.6rem;
            height: 1.6rem;
            margin-right: 0.4rem;
        }

        .dub_rank_list .dub_rank_item .rank_user_avatar {
            width: 1.7rem;
            height: 1.7rem;
            position: relative;
            border-radius: 100%;
        }

        .dub_rank_list .dub_rank_item .rank_user_avatar img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 100%;
        }

        .dub_rank_list .dub_rank_item .rank_user_name {
            font-size: 0.7rem;
            color: #6133DE;
            padding: 0 0.5rem;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .dub_rank_list .dub_rank_item .dub_like {
            width: 0.7rem;
            height: 0.7rem;
            margin-right: 0.5rem;
        }

        .dub_rank_list .dub_rank_item .dub_like_num {
            font-size: 0.8rem;
            color: #FE4973;
            font-weight: bold;
        }

        .load_complete {
            display: flex;
            justify-content: center;
            margin-top: -0.1rem;
            margin-bottom: 0;
            font-size: 0.6rem;
            line-height: 0.9rem;
            color: #ACACAC;
        }

        .load_complete span {
            position: relative;
        }

        .load_complete span:before {
            content: "";
            position: absolute;
            top: 0.4rem;
            left: -2rem;
            width: 1.25rem;
            height: 1px;
            background: #EAEAEA;
        }

        .load_complete span:after {
            content: "";
            position: absolute;
            top: 0.4rem;
            right: -2rem;
            width: 1.25rem;
            height: 1px;
            background: #EAEAEA;
        }

        .dub_speed_div {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.16);
        }

        .dub_speed_div .dub_speed_gray {
            /*position: absolute;
            top: 56vw;
            left: 0;
            bottom: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.16);*/
        }

        .dub_speed_alert {
            position: fixed;
            bottom: 0;
            left: 0.8rem;
            right: 0.8rem;
            height: auto;
            animation: moveBody 0.5s;
        }

        .dub_speed_alert .dub_speed_title {
            height: 3.1rem;
            background: #fff;
            position: relative;
            color: #2f2f2f;
            font-size: 0.8rem;
            line-height: 3.1rem;
            text-align: center;
            border-radius: 0.4rem 0.4rem 0 0;
        }

        .dub_speed_alert .dub_speed_title:after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            height: 1px;
            width: 100%;
            background: #eaeaea;
            transform: scaleY(0.5);
            -webkit-transform: scaleY(0.5);
            transform-origin: 0 0;
            -webkit-transform-origin: 0 0;
        }

        .dub_speed_alert .dub_speed_list {
            border-radius: 0 0 0.4rem 0.4rem;
            background: #fff;
            width: 100%;
            height: auto;
            color: #2f2f2f;
            font-size: 0.8rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            padding: 0.6rem 0;
        }

        .dub_speed_alert .dub_speed_list .dub_speed_item {
            width: 33.33%;
            font-weight: 500;
            height: 3.5rem;
            line-height: 3.5rem;
        }

        .dub_speed_alert .dub_speed_list .dub_speed_item.active {
            color: #3BAF58;
            position: relative;
        }

        .dub_speed_alert .dub_speed_list .dub_speed_item.active:after {
            content: "";
            position: absolute;
            bottom: 1rem;
            left: 50%;
            height: 0.2rem;
            width: 0.2rem;
            background: #3BAF58;
            transform: translateX(-50%);
            border-radius: 100%;
        }

        .dub_speed_alert .dub_speed_alert_back {
            width: 100%;
            line-height: 2.5rem;
            font-size: 0.7rem;
            text-align: center;
            color: #6D6D6D;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            border-radius: 0.4rem;
            background: #fff;
        }

        @keyframes moveBody {
            from {
                bottom: -18rem;
            }
            to {
                bottom: 0rem;
            }
        }

        @-webkit-keyframes moveBody {
            from {
                bottom: -18rem;
            }
            to {
                bottom: 0rem;
            }
        }

        .dub_video .video_btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2.1rem;
            height: 2.1rem;
        }
    </style>
</head>

<body>
    <div class="vueApp" v-cloak>
        <div class="dub_detail_top">
            <div class="dub_video">
                <video class="dub_detail_video" id="video_data" preload="meta" :poster="videoCover" :src="videoUrl" x5-playsinline="" playsinline="" webkit-playsinline="" onended="fnVideoEnd()">
                    <source :src="videoUrl" type="video/mp4"/>
                    <source :src="videoUrl" type="video/ogg"/>
                    <source :src="videoUrl" type="video/webm" />
                </video>
                <header>
                    <div class="dub_detail_header">
                        <img src="../image/index/dub_back.png" alt="" tapmode onclick="fnBack()">
                        <img src="../image/index/dub_speed.png" alt="" tapmode @click="fnCloseChangeSpeed('1')">
                    </div>
                </header>
                <div class="dub_play">
                    <img :src="inPlay=='0'?'../image/index/dub_play_btn.png':'../image/index/dub_pause_btn.png'" alt="" tapmode @click="inPlay=='0'?fnVideoPlay('1'):fnVideoPlay('0')">
                    <div class="dub_progress">
                        <p class="dub_time">{{fnSecToMin(currentTime)}}/{{fnSecToMin(duration)}}</p>
                        <div class="dub_progress_bar">
                            <input id="range" type="range" min="0" max="100" v-model="progress" step="1" oninput="change(this)">
                            <div class="rang_width_div">
                                <p class="rang_width" id="rang_width" :style="'width:'+progress+'%'"></p>
                            </div>
                        </div>
                    </div>
                    <img src="../image/index/dub_no_full.png" alt="" tapmode onclick="fnBack()">
                </div>
            </div>
            <p class="dub_title">{{videoName}}</p>
        </div>
        <div class="dub_speed_div" v-if="isChangeSpeed=='1'">
            <div class="dub_speed_gray">
                <div class="dub_speed_alert">
                    <div class="dub_speed_title">播放速度</div>
                    <div class="dub_speed_list">
                        <div :class="newSpeed==item.key?'dub_speed_item active':'dub_speed_item'" v-for="item in speedList" tapmode @click="fnSetNewsSpeed(item.key)">{{item.key}}X</div>
                    </div>
                    <div class="dub_speed_alert_back" tapmode @click="fnCloseChangeSpeed('0')">
                        取消
                    </div>
                </div>
            </div>
        </div>
    </div>
</body> 
<script type="text/javascript">
    var vm;  
    var _video;
    window.onload = function() {
        fnInit();
        _video = document.getElementById("video_data");
//      api.setScreenOrientation({
//          orientation: 'landscape_left'
//      });
        if (vm.inPlay == '1') {
            _video.play();
            _video.currentTime = vm.currentTime;
            fnEvevtVideo()
        };
//      api.addEventListener({
//          name: 'keyBack'
//      }, function(ret, err) {
//          if (ret) {
//              fnBack();
//          }
//      });

    }

    function fnInit() {
        vm = new Vue({
            el: ".vueApp",
            data: {
                progress:   '0',
                isChangeSpeed: "0",
                currentTime: 0,
                duration:  0,
                videoUrl:"",
                videoCover:"",
                videoName: "",
                inPlay:  "0", //视频是否在播放中 0否 1是
                newSpeed:  "1",
                speedList: [{
                    key: "0.5"
                }, {
                    key: "0.75"
                }, {
                    key: "1"
                }, {
                    key: "1.25"
                }, {
                    key: "1.5"
                }, {
                    key: "2"
                }]
            },
            mounted: function() {
                this.$nextTick(function() {
                    setTimeout(function() {
//                      var _readSafeTop = api.safeArea.top;
//                      var _safeBottom = api.safeArea.bottom;
//                      var _safeLeft = api.safeArea.left;
//                      $api.css($api.dom("header"), 'padding-top:' + _readSafeTop + 'px;');
//                      $api.css($api.dom(".vueApp"), 'padding-left:' + _safeLeft + 'px;');
//                      $api.css($api.dom(".vueApp"), 'padding-bottom:' + _safeBottom + 'px;');
                    }, 300)
                })
            },
            methods: {
                fnCloseChangeSpeed: function(key) {
                    this.isChangeSpeed = key;
                },
                fnSetNewsSpeed: function(key) {
                    this.newSpeed = key;
                    _video.playbackRate = key;
                    this.isChangeSpeed = '0';
                }
            }
        })
    }

    function fnBack() {
        api.setScreenOrientation({
            orientation: 'portrait_up'
        });
        fnDelayCloseWin()
    }

    function change(el) {
        //用于修改时间
//      vm.progress = $api.val(el);
//      _video.currentTime = _video.duration * (vm.progress / 100);
//      vm.currentTime = _video.duration * (vm.progress / 100);
//      vm.duration = _video.duration && _video.duration > 0 ? _video.duration : 0;
    }

    function fnVideoPlay(key) {
        vm.inPlay = key;
        if (key == '1') { //播放
            _video.play();
            // vm.progress = _video.duration && _video.duration > 0 ? (_video.currentTime / _video.duration) * 100 : '0'; //已播放百分比
            // vm.currentTime = _video.currentTime
            vm.duration = _video.duration && _video.duration > 0 ? _video.duration : 0;
            fnEvevtVideo()
        } else { //暂停
            _video.pause();
        }
    }

    function fnEvevtVideo() {
        _video.addEventListener("timeupdate", function() {
            vm.progress = _video.duration && _video.duration > 0 ? (_video.currentTime / _video.duration) * 100 : '0'; //已播放百分比
            vm.currentTime = _video.currentTime;
            vm.duration = _video.duration && _video.duration > 0 ? _video.duration : 0;
        })
    }
    //视频播放完成
    function fnVideoEnd() {
        vm.inPlay = '0';
//      api.execScript({
//          name: 'index/video_deatil_win',
//          frameName: 'index/video_deatil',
//          script: 'fnLock();'
//      });

    }

    function fnSecToMin(pSec) { //秒数变分钟数
        var min = Math.floor(pSec / 60),
            second = Math.floor(pSec % 60),
            hour, newMin, time;

        if (min > 60) {
            hour = Math.floor(min / 60);
            newMin = min % 60;
        }

        if (second < 10) {
            second = '0' + second;
        }
        if (min < 10) {
            min = '0' + min;
        }

        return time = hour ? (hour + ':' + newMin + ':' + second) : (min + ':' + second);

    }
</script>

</html>
